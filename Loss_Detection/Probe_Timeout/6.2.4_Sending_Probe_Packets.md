---
title: "6.2.4. 加速握手完成"
anchor: "6.2.4_Sending_Probe_Packets"
weight: 6240
rank: "h3"
---

当PTO计时器超时时，发送方{{< req_level MUST >}}发送一个在该数据包号空间中的ACK触发包来作为探测包。终端{{< req_level MAY >}}发送至多两个完整尺寸的包含ACK触发包的数据报来避免因为单个数据报遭遇丢包引发的代价高昂的连续PTO超时，或是为了在多个数据包号空间中发送数据。所有在PTO超时时发送的探测数据包都{{< req_level MUST >}}是能触发ACK的。

除了在超时的计时器所在的数据包号空间中发送数据外，发送方{{< req_level SHOULD >}}在其他具有在途数据的数据包号空间中发送ACK触发包，并且尽可能合并数据包。这在服务器同时具有在途的初始数据或握手数据时或在客户端同时具有在途的握手数据和应用数据时是非常有用的，因为对端可能只持有两个数据包号空间的接收密钥中的一个。

如果发送方想要在PTO超时时更快地引发确认，它可以跳过数据包号来消除确认延迟。

终端{{< req_level SHOULD >}}在因为PTO超时而发送的数据包中包含新数据。如果没有新数据可供发送，那么{{< req_level MAY >}}发送先前发送过的数据。QUIC实现{{< req_level MAY >}}使用其他策略来决定探测数据包的内容，比如基于应用所指定的优先级来发送新的数据或重传数据。

发送方有可能没有新数据也没有先前的数据用于发送。考虑这样一个例子：新的应用数据被发送于**流帧**中，被认定为丢包，随后在新的数据包中被重传，接着先前的数据包实际上得到了确认。当没有新数据可以发送时，发送方{{< req_level SHOULD >}}在数据包中发送**Ping帧**或其他ACK触发帧，来重新启动PTO计时器。

作为发送ACK触发包的替代，发送方{{< req_level MAY >}}将仍在途的数据包标记为丢包。这么做避免了发送额外的数据包，但是增大了过于激进地将数据包认定为丢包的风险，导致拥塞控制器不必要地降低发送速率。

连续的PTO超时会使得PTO的值以指数形式上升，随着数据包在网络中被持续丢弃，连接恢复所需的时间会以指数形式增长。在PTO超时时发送两个数据包提高了对数据包丢包的容忍度，因而降低了连续出现PTO超时事件的可能性。

当PTO计时器多次超时，没有新数据可以发送时，QUIC实现必须选择要么每次发送相同的载荷，要么发送不同的载荷。发送相同的载荷可能会更简单，并且确保了能首先送达最高优先级的帧。每次发送不同的载荷则减少了出现无效重传的机会。
